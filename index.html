<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>emmmmmmm</title>
    <link rel="icon" href="static/favicon.ico" type="image/png" >

    <script src="static/vue.js"></script>
    <link rel="stylesheet" href="static/index.css">
    <script src="static/index.js"></script>
    <script src="static/axios.js"></script>

</head>
<body>
<div id="app" style="margin-top: 5%" v-loading="loading">


    <el-row>
        <el-col :xl="{span:8,offset:8}" :lg="{span:10,offset:7}" :sm="{span:12,offset:6}" >
            <el-row>
                <el-col :span="8">
                    <el-autocomplete
                            class="inline-input"
                            prefix-icon="el-icon-search"
                            v-model="keyword"
                            :fetch-suggestions="querySearch"
                            placeholder="请输入名称"
                            :trigger-on-focus="false"
                            @select="select"
                            @input="input"
                    ></el-autocomplete>
                </el-col>
            </el-row>
            <el-table
                    :data="list"
                    style="width: 100%">
                <el-table-column
                        prop="cover"
                        label="封面"
                        width="180">
                    <template slot-scope="scope">
                        <el-image :src="scope.row.cover" style="height: 54px">
                            <div slot="error" class="image-slot">
                                <i class="el-icon-picture-outline"></i>
                            </div>
                        </el-image>
                    </template>

                </el-table-column>
                <el-table-column
                        prop="title"
                        label="标题"
                        width="300">
                </el-table-column>
                <el-table-column
                        fixed="right"
                        label="操作"
                        width="120">
                    <template slot-scope="scope">
                        <el-button @click="buy(scope.row)" type="success" >待开发</el-button>
                    </template>
                </el-table-column>
            </el-table>
            <el-pagination
                    @current-change="handleCurrentChange"
                    :current-page="current"
                    :page-size="6"
                    layout="total, prev, pager, next, jumper"
                    :total="total">
            </el-pagination>
        </el-col>
    </el-row>
</div>
<script>

    // let baseUrl = "http://localhost:8989/pages"
    let baseUrl = "https://www.aslucky.club/pages"



    var app = new Vue({
        el: '#app',
        data: {
            loading:false,
            keyword:'',
            current:1,
            total:1,
            list:[],
        },
        mounted(){

          axios.get(baseUrl + "/list").then(res => {
            console.log(this.list = res.data)

            this.list.forEach((item) => {
              item.cover = JSON.parse(item.cover)[0]
            })

          })


        },
        methods: {
            handleCurrentChange(val) {
                this.current = val
                this.update()
            },
            querySearch (queryString, cb) {
                queryString = queryString.toUpperCase().trim();
                let results = this.itemListSrc.filter((item) => {
                    return item.itemName.indexOf(queryString) === 0
                })
                cb(results);
            },
            select(){
                this.current = 1
                this.update()
            },
            input(){
                this.current = 1
                this.update()
            },
            update(){
                if (this.keyword){
                    let keyword = this.keyword.toUpperCase().trim()
                    this.itemList = this.itemListSrc.filter(item => {
                        return item.value.indexOf(keyword) > -1
                    })
                }else {
                    this.itemList = this.itemListSrc
                }

                this.total = this.itemList.length

                this.itemList = this.itemList.slice((this.current - 1)*6,this.current * 6)


            }
            ,getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
                }
                return(false);
            }
        }
    })


</script>
</body>
</html>